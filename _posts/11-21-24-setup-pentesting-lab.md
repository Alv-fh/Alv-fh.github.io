---
title: Configurar un Laboratorio de Pentesting con VirtualBox 👷
description: Veremos cómo configurar un Laboratorio de Pentesting en VirtualBox para practicar.
date: 2024-11-21
categories: [VirtualBox, CTF, Pentesting]
tags: [VirtualBox, CTF, Pentesting, Machines]
img_path: "assets/img/pivoting-ejptv2.png"
image: "assets/img/pivoting-ejptv2.png"
---

# 👷 Cómo configurar tu propio laboratorio para practicar Pivoting en VirtualBox

- [👷 Cómo configurar tu propio laboratorio para practicar Pivoting en VirtualBox](#-cómo-configurar-tu-propio-laboratorio-para-practicar-pivoting-en-virtualbox)
    - [Introducción](#introducción)
    - [VirtualBox](#virtualbox)
    - [Requisitos Previos](#requisitos-previos)
    - [Paso 1: Instalar VirtualBox y Configurarlo](#paso-1-instalar-virtualbox-y-configurarlo)
    - [Paso 2: Crear y Configurar diferentes Redes NAT](#paso-2-crear-y-configurar-diferentes-redes-nat)
    - [Paso 3: Crear y Configurar Máquinas Virtuales](#paso-3-crear-y-configurar-máquinas-virtuales)
      - [- Máquina atacante, en mi caso (Kali Linux)](#--máquina-atacante-en-mi-caso-kali-linux)
      - [- Máquinas Vulnerables, en este caso de Vulnyx](#--máquinas-vulnerables-en-este-caso-de-vulnyx)
    - [Paso 4: Comprobar el Funcionamiento de todo el Laboratorio](#paso-4-comprobar-el-funcionamiento-de-todo-el-laboratorio)
    - [Paso 5: Realizar Laboratorio y Comprobar que la otra Red Funciona](#paso-5-realizar-laboratorio-y-comprobar-que-la-otra-red-funciona)
    - [Mi opinión](#mi-opinión)

### Introducción

En este post, exploraremos detalladamente cómo crear un laboratorio en VirtualBox diseñado específicamente para practicar técnicas de pivoting. Este entorno no solo es ideal para entender conceptos fundamentales de redes y explotación, sino que también está enfocado en proporcionar una experiencia práctica alineada con los objetivos de la certificación eLearnSecurity Junior Penetration Tester (eJPTv2).

El laboratorio simula un escenario realista donde será necesario navegar entre diferentes redes y equipos para comprometer sistemas, aplicar técnicas de redireccionamiento de tráfico y lograr acceso a máquinas que de otra manera serían inaccesibles. A lo largo de este tutorial, configuraremos varias máquinas virtuales, organizadas en subredes conectadas estratégicamente, y emplearemos herramientas clave.

Si estás preparándote para la eJPTv2 o simplemente deseas mejorar tus habilidades en pentesting, este laboratorio es una excelente manera de fortalecer tus conocimientos en un entorno controlado.

### VirtualBox

VirtualBox es una herramienta de virtualización gratuita y ampliamente utilizada. Permite crear y ejecutar múltiples máquinas virtuales (VMs) en tu ordenador, ideal para montar un entorno de práctica de pentesting. Con VirtualBox, puedes simular redes reales y trabajar con máquinas vulnerables, evitando cualquier riesgo para tu red principal.

### Requisitos Previos

Antes de empezar, asegúrate de tener lo siguiente:

- PC con suficiente capacidad de RAM y almacenamiento.

- VirtualBox

- ISO o imágenes de máquinas virtuales vulnerables.

### Paso 1: Instalar VirtualBox y Configurarlo

- Descarga VirtualBox desde el sitio oficial de Oracle e instálalo.

  [🔗 **Enlace de Descarga**](https://www.virtualbox.org/wiki/Downloads)

- **Configuración de Preferencias**: En "Preferencias" de VirtualBox, define el directorio donde se almacenarán las máquinas virtuales.

### Paso 2: Crear y Configurar diferentes Redes NAT

- En este paso crearemos distintas redes NAT ya que vamos a configurar este laboratorio para poder realizar **pivoting**.

- Creación y Configuración de una Red NAT:

  - **Paso 2.1** -> Entramos en la configuración de red de VirtualBox
  
  ![2](/assets/img/ctf-build/2.png)
  
  - **Paso 2.2** -> Entramos en **Redes NAT** y luego a **Crear** para crear una Red NAT.
  
  ![3](/assets/img/ctf-build/3.png)

  - **Paso 2.3** -> A continuación editaremos el nombre y el rango de IP de nuestra red privada (NAT). Dejaremos desactivadas las IPv6.
    
    En función de la clase de la IP, cambiará la máscara de subred. En mi caso es **Clase C** por lo que sería **/24**.
  
  ![4](/assets/img/ctf-build/4.png)

  - **Paso 2.4** -> Le damos a **Aplicar** para crer la red NAT.
  
  ![5](/assets/img/ctf-build/5.png)

  - **Paso 2.5** -> Crearemos otra red NAT para este laboratorio. Se llamaŕa **Alv-Red2** y el rango será **172.17.2.0/24**

  ![9](/assets/img/ctf-build/9.png)

### Paso 3: Crear y Configurar Máquinas Virtuales

#### - Máquina atacante, en mi caso (Kali Linux)

- Tendremos **2 Tarjetas de Red**. Para poder acceder a Internet y tener conexión con otras máquinas. No "sabremos" la otra tarjeta de red y la tendremos que descubrir (Esa es la gracia).

  - **Paso 3.1** -> En el **Adaptador 1** tendremos la tarjeta que se podrá conectar con Internet. En mi caso la he puesto **NAT**
    
    *¿Por qué NAT?*

    - Por el simple hecho de que brinda más seguridad ya que crea una subred privada creada por VirtualBox y además tenemos conexión con el exterior si el PC anfitrión tiene.
    
    - Básicamente es como si el equipo real estuviera intercambiando tráfico, ya que se hace NAT sobre la dirección IP privada real del equipo en cuestión.

  ![6](/assets/img/ctf-build/6.png)

  - **Paso 3.2** -> En el **Adaptador 2** tendremos la Red NAT **Alv-Red** que será la red privada que conocemos con nuestro Kali.

    - Activaremos el modo promiscuo para poder ver el tráfico de la red.
  
  ![10](/assets/img/ctf-build/10.png)  
  
  - **Paso 3.3** -> Le damos a Aceptar para aplicar cambios.

![11](/assets/img/ctf-build/11.png)

#### - Máquinas Vulnerables, en este caso de [Vulnyx](https://vulnyx.com/)

- 1º Máquina: [Wicca](https://mega.nz/file/YbBDjQDI#vV964toDsXFloNjT0sfIZ1mmTC23EiGUiJ3HIdDeqD8)

  - **Paso 3.4** -> Esta máquina solo tendrá una red, que es la red interna **Alv-Red** tenemos en nuestro Kali. Será de despiste, pero para practicar, la tendremos que hackear.  

![8](/assets/img/ctf-build/8.png)

- 2º Máquina (Puente): [Eternal](https://mega.nz/file/kPIiwRhZ#wiO8ddEp3LN7fZLfjF77A--VJtB8wsp6qakYJyx1wfU)

  - **Paso 3.5** -> Esta será la máquina Puente, con la que realizaremos el Pivoting. Para ello tendremos 2 tarjetas de Red.

    - Tarjeta de Red 1: Red NAT -> **Alv-Red**

    ![11](/assets/img/ctf-build/12.png)

    - Tarjeta de Red 2: Red NAT -> **Alv-Red2**

    Aquí estará la otra red oculta que tenemos que descubrir.

    1 - Entraremos en el **Adaptador 2**.

    2 - Elegiremos **Red NAT**.

    3 - Seleccionamos nuestra red creada.

    4 - Permitimos el modo promiscuo para poder ver el tráfico de la red.

    5 - Le damos a Aceptar para aplicar cambios.

    ![13](/assets/img/ctf-build/13.png)

- 3º Máquina (Red Oculta): [Fire](https://mega.nz/file/hfwwgZQS#PrlxyDa-eAT_PtA66Qx1Hb255gpxCXKFhTUQkH75qpw)

  - **Paso 3.6** -> Esta máquina será la oculta, la que solo tiene conexión con la máquina puente. Estará en la Red **Alv-Red2**.

![14](/assets/img/ctf-build/14.png)

### Paso 4: Comprobar el Funcionamiento de todo el Laboratorio

- Comprobamos que se ha configurado todo correctamente escaneando la red y comprobando las tarjetas de red.

- Para ello:

  - **Paso 4.1** -> Entramos en Kali Linux y comprobamos las tarjetas de red con el comando `ip a`

    - eth0 -> Es nuestra primera tarjeta de red que está en NAT con IP: 10.0.2.15

    - eth1 -> Es nuestra red privada (Alv-Red) con IP: 10.10.10.4
  
    ![15](/assets/img/ctf-build/15.png)
  
  - **Paso 4.2** -> Hacemos un escaneo de la red privada para descubrir nuevos hosts `sudo arp-scan -I eth1 --localnet`

  ![16](/assets/img/ctf-build/16.png)

  - Vemos posibles hosts que están en la red.
  
  - **Paso 4.3** -> Hago ping a cada IP y deduzco lo siguiente:

  10.10.10.3 -> Switch o Router | TTL=255

  10.10.10.5 -> Máquina Windows | TTL=128

  10.10.10.6 -> Máquina Linux | TTL=64
  
  ![17](/assets/img/ctf-build/17.png)

### Paso 5: Realizar Laboratorio y Comprobar que la otra Red Funciona

- Por último empezariamos a hacer el laboratorio hackeando cada máquina y comprobariamos que funciona haciendo pivoting.

- Para ello dejo un enlace resolviendo este laboratorio en mi canal de youtube:

[🔗 **Link del vídeo**](https://www.youtube.com/watch?v=-snSRa6pOOM)

### Mi opinión

Creo que es una muy buena idea implementar un laboratorio de este estilo para familiarizarnos con técnicas como el pivoting ya que la configuración es muy sencilla y la tenemos en un plis plas. Podemos poner la dificultad que queramos añadiendo más máquinas, máquinas más difíciles, básicamente es muy personalizable.